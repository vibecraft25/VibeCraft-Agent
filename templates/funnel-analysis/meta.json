{
  "type": "funnel-analysis",
  "name": "Funnel Analysis",
  "description": "전환 퍼널 분석 및 드롭오프 시각화",
  "requiredLibraries": ["recharts", "@nivo/funnel", "react-sankey-diagram"],
  "systemPrompt": "Create a funnel analysis visualization for tracking conversion rates, drop-offs, and user journey through stages.",
  "componentStructure": {
    "mainComponents": [
      {
        "name": "FunnelChart",
        "description": "Main funnel visualization",
        "props": [
          { "name": "stages", "type": "FunnelStage[]" },
          { "name": "orientation", "type": "'vertical' | 'horizontal'" },
          { "name": "onStageClick", "type": "(stage: FunnelStage) => void" }
        ],
        "features": ["interactive", "animations", "tooltips", "drill-down"]
      },
      {
        "name": "ConversionMetrics",
        "description": "Conversion rate metrics display",
        "props": [
          { "name": "stages", "type": "FunnelStage[]" },
          { "name": "timeRange", "type": "TimeRange" }
        ],
        "features": ["rates", "trends", "comparisons"]
      },
      {
        "name": "DropoffAnalysis",
        "description": "Drop-off analysis between stages",
        "props": [
          { "name": "stages", "type": "FunnelStage[]" },
          { "name": "showReasons", "type": "boolean" }
        ],
        "features": ["reasons", "segmentation", "recommendations"]
      }
    ],
    "supportingComponents": [
      {
        "name": "StageDetails",
        "description": "Detailed view of a funnel stage",
        "props": [
          { "name": "stage", "type": "FunnelStage" },
          { "name": "segments", "type": "Segment[]" }
        ],
        "features": ["breakdown", "time-analysis", "cohorts"]
      },
      {
        "name": "FunnelComparison",
        "description": "Compare multiple funnels",
        "props": [
          { "name": "funnels", "type": "Funnel[]" },
          { "name": "comparisonType", "type": "ComparisonType" }
        ],
        "features": ["side-by-side", "overlay", "benchmarks"]
      }
    ],
    "hooks": [
      {
        "name": "useFunnelData",
        "description": "Hook for fetching and processing funnel data"
      },
      {
        "name": "useConversionCalculation",
        "description": "Hook for calculating conversion metrics"
      }
    ],
    "utils": [
      {
        "name": "funnelCalculations",
        "description": "Conversion rate and drop-off calculations"
      },
      {
        "name": "segmentationUtils",
        "description": "User segmentation utilities"
      }
    ]
  },
  "dataProcessingPatterns": [
    {
      "name": "Stage Progression Query",
      "sqlTemplate": "SELECT {{stageColumn}}, COUNT(DISTINCT {{userIdColumn}}) as users FROM {{table}} GROUP BY {{stageColumn}} ORDER BY {{orderColumn}}",
      "dataTransformation": "calculateFunnelMetrics(results)"
    },
    {
      "name": "Time-based Funnel",
      "sqlTemplate": "SELECT {{stageColumn}}, {{timeColumn}}, COUNT(DISTINCT {{userIdColumn}}) as users FROM {{table}} WHERE {{timeColumn}} BETWEEN ? AND ? GROUP BY {{stageColumn}}, date({{timeColumn}})",
      "dataTransformation": "buildTimeSeriesFunnel(results)"
    },
    {
      "name": "Cohort Funnel",
      "sqlTemplate": "SELECT {{cohortColumn}}, {{stageColumn}}, COUNT(DISTINCT {{userIdColumn}}) as users FROM {{table}} GROUP BY {{cohortColumn}}, {{stageColumn}}",
      "dataTransformation": "buildCohortFunnels(results)"
    }
  ]
}